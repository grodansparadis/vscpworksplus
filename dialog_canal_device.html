<!DOCTYPE html>
<html lang="en">

<head>
    <title>CANAL Device</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="./contents/bootstrap/4.3.1/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./node_modules/animate.css/animate.min.css">
</head>

<body class="bg-light">

    <div class="container">
        <div class="col-sm-12 text-center">
            <h2>CANAL Interface</h2>
        </div>
        <form action="" class="needs-validation" novalidate>

            <div class="form-group">
                <label class="font-weight-bold" for="description">Description:</label>
                <input type="text" class="form-control form-control-sm" id="driverName" placeholder="Enter descriptive name"
                    name="name" required>
                <div class="valid-feedback"></div>
                <div class="invalid-feedback">There must be a descriptive string for the driver.</div>
            </div>

            <div class="form-group ">
                <label class="font-weight-bold" for="description">Path:</label>
                <div class="input-group input-file" name="path">
                    <input type="text" class="form-control form-control-sm" placeholder='Choose a file...' required />
                    <span class="input-group-btn">
                        &nbsp;
                        <button class="btn-sm btn-default btn-choose" type="button">Choose</button>
                        <button type="reset" class="btn-sm btn-default">Reset</button>
                    </span>
                    <div class="valid-feedback"></div>
                    <div class="invalid-feedback">There must be a path for a valid CANAL driver.</div>
                </div>

            </div>

            <div class="form-group">
                <label class="font-weight-bold" for="description">Configuration:</label>
                <input type="text" class="form-control form-control-sm" id="description"
                    placeholder="Enter configuration" name="description">
            </div>
            <div class="form-group">
                <label class="font-weight-bold" for="flags">Flags:</label>
                <input type="password" class="form-control form-control-sm" id="flags" placeholder="Enter flags"
                    name="flags">
            </div>

            <div class="col-sm-12 text-center">
                <button type="button" class="btn btn-warning  form-control-sm">Configuration wizard</button>
                <div>
                    <hr />
                </div>
                <div class="row">
                    <div class="col-sm-12 text-center">
                        <button id="btnCancel" type="submit" class="btn-sm btn-default">Cancel</button>
                        <button id="btnSubmit" type="submit" class="btn-sm btn-default">OK</button>
                    </div>
                </div>


        </form>
    </div>

    <!-- Bootstrap Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script>let $ = jQuery = require('jquery');</script>
    <script>require('popper.js');</script>
    <script>require('bootstrap');</script>

</body>

<script>
    let valSelected = '';
    const { remote, ipcRenderer } = require('electron');
    const { app } = remote;

    let validate = function () {
        // // Get the forms we want to add validation styles to
        // var forms = document.getElementsByClassName('needs-validation');
        // console.log(forms);
        // // Loop over them and prevent submission
        // var validation = Array.prototype.filter.call(forms, function (form) {
        //     if (form.checkValidity() === false) {
        //         return false;
        //         //event.preventDefault();
        //         //event.stopPropagation();
        //     }
        //     form.classList.add('was-validated');
        // });
        let name = name = $("#driverName").val();
        //document.getElementById("driverName").value = "Johnny Bravo";
        if ( 0 == name.trim().length) {

            return false;
        }
        return true;
    };

    // Disable form submissions if there are invalid fields
    // (function () {

    //     // Get the forms we want to add validation styles to
    //     var forms = document.getElementsByClassName('needs-validation');
    //     // Loop over them and prevent submission
    //     var validation = Array.prototype.filter.call(forms, function (form) {

    //         if (form.checkValidity() === false) {
    //             event.preventDefault();
    //             event.stopPropagation();
    //         }
    //         form.classList.add('was-validated');
    //     });
    // })();

    // File selection
    // function bs_input_file() {
    //     $(".input-file").before(
    //         function () {
    //             if (!$(this).prev().hasClass('input-ghost')) {
    //                 var element = $("<input type='file' class='input-ghost' style='visibility:hidden; height:0'>");
    //                 element.attr("name", $(this).attr("name"));
    //                 element.change(function () {
    //                     element.next(element).find('input').val((element.val()).split('\\').pop());
    //                 });
    //                 $(this).find("button.btn-choose").click(function () {
    //                     element.click();
    //                 });
    //                 $(this).find("button.btn-reset").click(function () {
    //                     element.val(null);
    //                     $(this).parents(".input-file").find('input').val('');
    //                 });
    //                 $(this).find('input').css("cursor", "pointer");
    //                 $(this).find('input').mousedown(function () {
    //                     $(this).parents('.input-file').prev().click();
    //                     return false;
    //                 });
    //                 return element;
    //             }
    //         }
    //     );
    // }
    // $(function () {
    //     bs_input_file();
    // });

    function Submit() {
        ipcRenderer.send("dialog-close", valSelected);
        this.close();
        console.log("Close CANAL window");
    }

    $(document).ready(function ($) {

        // Cancel
        $("#btnCancel").on('click', function (e) {
            e.preventDefault(); // To prevent following the link (optional)
            valSelected = "canal";
            Submit();
            remote.getCurrentWindow().close();
        });

        // Save new driver info
        $("#btnSubmit").on('click', function (e) {
            e.preventDefault(); // To prevent following the link (optional)
            if (validate()) {
                valSelected = "canal";
                Submit();
                remote.getCurrentWindow().close();
            }
        });

    });

</script>

</html>